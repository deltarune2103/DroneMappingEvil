- type: htnCompound
  id: DroneCompoundMedusa
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:UtilityOperator
        proto: NearbyShuttleTargets
    - !type:HTNCompoundTask
      task: ShuttleAttackDroneCompoundMedusa

- type: htnCompound
  id: ShuttleAttackDroneCompoundMedusa
  branches:
  - preconditions:
    - !type:KeyExistsPrecondition
      key: TargetCoordinates
    tasks:
    - !type:HTNPrimitiveTask
      operator: !type:ShipMoveToOperator
        shutdownState: PlanFinished
        removeKeyOnFinish: false
        inRangeMaxSpeed: null
        range: 250
        rangeTolerance: 50
        targetKey: TargetCoordinates
        mode: Orbit
    - !type:HTNPrimitiveTask
      operator: !type:ShipFireGunsOperator
        shutdownState: TaskFinished
        removeKeyOnFinish: false
        leadingAccuracy: 0.2
        targetKey: TargetCoordinates
      services:
      - !type:UtilityService
        id: TargetsService
        proto: NearbyShuttleTargets
        key: Target
        coordinatesKey: TargetCoordinates

- type: htnCompound
  id: DroneCompoundMPulsar
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:UtilityOperator
        proto: NearbyShuttleTargets
    - !type:HTNCompoundTask
      task: ShuttleAttackDroneCompoundMPulsar

- type: htnCompound
  id: ShuttleAttackDroneCompoundMPulsar
  branches:
  - preconditions:
    - !type:KeyExistsPrecondition
      key: TargetCoordinates
    tasks:
    - !type:HTNPrimitiveTask
      operator: !type:ShipMoveToOperator
        shutdownState: PlanFinished
        removeKeyOnFinish: false
        alwaysFaceTarget: true
        inRangeMaxSpeed: 20
        avoidProjectiles: true
        range: 45
        rangeTolerance: 15
        targetKey: TargetCoordinates
    - !type:HTNPrimitiveTask
      operator: !type:ShipFireGunsOperator
        shutdownState: TaskFinished
        removeKeyOnFinish: false
        leadingAccuracy: 0.7
        targetKey: TargetCoordinates
      services:
      - !type:UtilityService
        id: TargetsService
        proto: NearbyShuttleTargets
        key: Target
        coordinatesKey: TargetCoordinates

- type: htnCompound
  id: DroneCompoundLance
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:UtilityOperator
        proto: NearbyShuttleTargets
    - !type:HTNCompoundTask
      task: ShuttleAttackDroneCompoundLance

- type: htnCompound
  id: ShuttleAttackDroneCompoundLance
  branches:
  - preconditions:
    - !type:KeyExistsPrecondition
      key: TargetCoordinates
    tasks:
    - !type:HTNPrimitiveTask
      operator: !type:ShipMoveToOperator
        shutdownState: PlanFinished
        removeKeyOnFinish: false
        alwaysFaceTarget: true
        inRangeMaxSpeed: 50
        avoidProjectiles: true
        range: 350
        rangeTolerance: 50
        targetKey: TargetCoordinates
    - !type:HTNPrimitiveTask
      operator: !type:ShipFireGunsOperator
        shutdownState: TaskFinished
        removeKeyOnFinish: false
        leadingAccuracy: 0.4
        targetKey: TargetCoordinates
      services:
      - !type:UtilityService
        id: TargetsService
        proto: NearbyShuttleTargets
        key: Target
        coordinatesKey: TargetCoordinates

- type: htnCompound
  id: AttackerShuttleSmartStaticCompound
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:UtilityOperator
        proto: NearbyShuttleTargets
    - !type:HTNCompoundTask
      task: ShuttleAttackSmartStaticCompound

- type: htnCompound
  id: ShuttleAttackSmartStaticCompound
  branches:
  - preconditions:
    - !type:KeyExistsPrecondition
      key: TargetCoordinates
    tasks:
    - !type:HTNPrimitiveTask
      operator: !type:ShipMoveToOperator
        shutdownState: PlanFinished
        removeKeyOnFinish: false
        alwaysFaceTarget: true
        inRangeMaxSpeed: 4
        avoidProjectiles: true
        range: 750
        rangeTolerance: 150
        targetKey: TargetCoordinates
    - !type:HTNPrimitiveTask
      operator: !type:ShipFireGunsOperator
        shutdownState: TaskFinished
        removeKeyOnFinish: false
        leadingAccuracy: 0.6 # knows how to aim
        targetKey: TargetCoordinates
      services:
      - !type:UtilityService
        id: TargetsService
        proto: NearbyShuttleTargets
        key: Target
        coordinatesKey: TargetCoordinates
